# bilib

整合多个B站API的Python lib

bili + lib = bilib

前身为danlib，如果你在我的GitHub找到了danlib，你可以继续使用它，但如果你要改为使用bilib，你需要修改你的代码

这个lib可以帮助你完成用户基本信息（粉丝量关注数等）和弹幕（需提供cid）的爬取

实验性功能：获取视频信息，获取番剧/电影信息和章节列表

除弹幕功能以bs4为核心外，其它功能均以requests为核心，你可能还需要安装fake_useragent和csv包来让bilib正常工作

请勿将此lib用于非法用途（包括敏感数据爬取和DoS/DDoS攻击），作者将不承担任何责任，使用此lib视为已遵守此规则

## 稳定功能的API

这部分包含了我从2020年5月开始调试的代码，目前爬取100w+数据后仍能稳定工作

### user_info(uid_input, get_ua=False)

功能： 获取一个用户的基本信息（粉丝，关注，UID，昵称）

必要的传参：用户的UID（uid_input）

选择的传参：要求返回爬取此用户数据用到的User Agent(get_ua)，默认不返回UA（False）

返回：字典，形式为return_dict = {"uid_input": 用户输入的UID, "name": 昵称, "fans": 粉丝数, "following": 关注数, "st_code": HTTP状态码, "ua": User Agent}

异常：此API只会遇到三个异常：HTTP 404, HTTP 412，HTTP 200但无法分离昵称

	• HTTP 404
  
    表示此用户不存在/已销号，返回昵称为'(##BLANK_USER##)'，包含单引号
    
    注意，销号用户也有可能查到其粉丝量等
    
	• HTTP 412（事实上时指除200和404以外的情况，只有412）
  
    表示已触发反爬取机制，一般在30-40分钟后恢复
    
    会抛出InfoError，不返回任何值
  
	• HTTP 200但无法分离昵称
  
    这可能是B站彩蛋？具体表现之一为访问其主页只会看到几个字
    
    返回昵称为'(##WDNMD_USER##)'，包含单引号

### get_danmaku(cid_input, reset=False)

功能： 获取一个视频的弹幕，包括番剧/电影（最多返回8000条）

必要的传参：视频的cid（cid_input）, 只能输入数字, 可以通过实验性功能或者浏览器F12功能获得cid

选择的传参：文件存在时强制刷新（reset），默认询问是否刷新（False），此处可能会修改为可以选择强制不刷新

返回：弹幕文件的绝对路径，文件为csv，直接使用cid命名，同时打印绝对路径

异常：目前没有检查到这个API会触发反爬取，但保险起见，遇到任何异常会直接抛出

### listall_danmaku(file_path, stamp=False)

功能：处理弹幕文件，并输出

必要的传参：弹幕文件的绝对路径（file_path）

选择的传参：返回现实时间的时间戳而非转化的时间（stamp），默认返回转化的时间（False）

返回：字典，key为序号(int),value分别为：视频内发送时间，弹幕类型，弹幕字号，弹幕颜色，现实发送时间，弹幕池，用户ID（被加密），rowID，发送内容（如果是高级弹幕，还会在这里包含一些参数）。如果遇到了全新的弹幕类型，会不处理直接返回

异常：现有的弹幕文件结构不会造成此API的异常

### count_danmaku(file_path)

功能：获取弹幕文件行数

必要的传参：弹幕文件的绝对路径（file_path）

选择的传参：无

返回：一个数字，此为弹幕文件总行数

异常： 除非弹幕文件不存在，否则不太可能会触发异常
